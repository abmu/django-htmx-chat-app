{% extends 'chat/home.html' %}
{% block subcontent %}
    <h1>{{ recipient }}</h1>
    {% if not is_friends %}
        <p>You cannot message this user because they are not on your friends list</p>
    {% endif %}
    <form method="POST" action="{% url 'direct_message' recipient.username %}">
        {% csrf_token %}
        {{ form }}
        <button type="submit">Send</button>
    </form>
    {% for group in grouped_messages %}
        <p>{{ group.date|date:"Y-m-d" }}</p>
        {% for msg in group.messages %}
            {% if msg.is_first_new %}
                <p>New messages</p>
            {% endif %}
            <ul>
                <li>From: {{ msg.sender }}</li>
                <li>To: {{ msg.recipient }}</li>
                <li style="white-space: pre-wrap;">{{ msg.content }}</li>
                <li>{{ msg.timestamp }}</li>
                {% if msg.sender == user %}
                    <li>Read: {{ msg.was_read }}</li>
                {% endif %}
            </ul>
        {% endfor %}
    {% endfor %}
{% endblock subcontent %}