{% extends 'chat/home.html' %}
{% block home_content %}
    <ul>
        <li>
            <a href="{% url 'friends_list' %}">All friends</a> (<span id="friends-count">{{ friends_mutual|length }}</span>)
        </li>
        <li>
            <a href="{% url 'incoming_requests' %}">Incoming requests</a> (<span id="incoming-count">{{ incoming_requests|length }}</span>)
        </li>
        <li>
            <a href="{% url 'outgoing_requests' %}">Outgoing requests</a> (<span id="outgoing-count">{{ outgoing_requests|length }}</span>)
        </li>
        <li>
            <a href="{% url 'add_friend' %}">Add friend</a>
        </li>
    </ul>
    
    {% block manage_friends_content %}
    {% endblock manage_friends_content %}
    <script>
        function removeUserFromSection(section, otherUserUuid) {
            const prefix = section === 'friends' ? 'friend-' : `${section}-`
            const userElement = document.getElementById(`${prefix}${otherUserUuid}`);
            userElement.remove();
        }

        function binaryInsertInOrder(newElement, container) {
            const children = container.children;
            const newUsername = newElement.dataset.username;

            let left = 0;
            let right = children.length - 1;

            while (left <= right) {
                const mid = Math.floor((left + right) / 2);
                const midUsername = children[mid].dataset.username.toLowerCase();

                if (midUsername < newUsername) {
                    left = mid + 1;
                } else if (newUsername < midUsername) {
                    right = mid - 1;
                } else {
                    return;
                }
            }

            if (left < children.length) {
                container.insertBefore(newElement, children[left]);
            } else {
                container.appendChild(newElement);
            }
        }

        function addUserHtmlToSection(section, html) {
            const newUserElement = htmlToElement(html);
            const suffix = section === 'friends' ? '-list' : '-requests';
            const container = document.getElementById(`${section}${suffix}`);
            binaryInsertInOrder(newUserElement, container);
        }
    </script>
{% endblock home_content %}